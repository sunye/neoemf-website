<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: NeoEMF - Website</title>
    <meta name="generator" content="Antora 3.0.0-alpha.10">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://sunye.github.io/neoemf-website">NeoEMF - Website</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="NeoEMF" data-version="2.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">NeoEMF Project</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">NeoEMF</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">index.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">NeoEMF Project</span>
    <span class="version">2.0.0 2.0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">NeoEMF Project</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">2.0.0 2.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/atlanmod/NeoEMF/edit/master/neoemf-doc/modules/developer/pages/Code-Generation-With-Maven.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="paragraph">
<p>To generate some code from an EMF model, it&#8217;s possible to use the xText Maven plugin which provides some features, including code generation from an Xcore model.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Xcore is an extended concrete syntax for Ecore that, in combination with <a href="https://www.eclipse.org/Xtext/#xbase">Xbase</a>, transforms it into a fully fledged programming language with high quality tools reminiscent of the Java Development Tools.
You can use it not only to specify the structure of your model, but also the behavior of your operations and derived features as well as the conversion logic of your data types.
It eliminates the dividing line between modeling and programming, combining the advantages of each.
All this is supported for both generated and dynamic <a href="https://www.eclipse.org/modeling/emf/">EMF</a> models.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; +++<cite>+++https://wiki.eclipse.org/Xcore[Xcore official website]+++</cite>+++
</div>
</div>
<div class="sect1">
<h2 id="_create_or_update_existing_models"><a class="anchor" href="#_create_or_update_existing_models"></a>Create or Update Existing Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the code generation in Maven, it&#8217;s necessary to create an Xcore model. There is two way to do that :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Directly <a href="https://wiki.eclipse.org/Xcore#Creating_an_Xcore_model">create an Xcore model</a>.</p>
</li>
<li>
<p>Create or edit existing Ecore or GenModel files, then <a href="https://wiki.eclipse.org/Xcore#Converting_a_GenModel_to_an_Xcore_Model">generate an Xcore model</a> from them. You can easily convert an existing Ecore model to a Xcore model, and vice versa.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See all procedures on the <a href="https://wiki.eclipse.org/Xcore">Xcore official website</a>.</p>
</div>
<div class="paragraph">
<p><strong>WARNING</strong> :
When you generate an Xcore model, <code>pluginID</code> and <code>pluginKey</code> parameters are added to the <code>@GenModel</code> annotation in Xcore header.
<strong>You must remove these parameters when they are included in a Maven project</strong>, otherwise an <code>IOException</code> will be thrown during the build :
they identify Eclipse plugin files (<em>build.properties</em>, <em>plugin.properties</em> and <em>plugin.xml</em>) which are not useful for code generation, and cannot be found in the project root if you don&#8217;t insert them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_project_using_xcore_code_generation"><a class="anchor" href="#_create_a_project_using_xcore_code_generation"></a>Create a Project Using Xcore Code Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some lines must be added to the <em>pom.xml</em>.</p>
</div>
<div class="sect2">
<h3 id="_generate_at_a_specific_jdk_level"><a class="anchor" href="#_generate_at_a_specific_jdk_level"></a>Generate at a Specific JDK Level</h3>
<div class="paragraph">
<p>The code generation can be configured to follow a specific JDK level:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your Xcore model must have a <code>complianceLevel</code> parameter in the <code>@GenModel</code> annotation. Its value must be greater or equal to the targetted JDK.</p>
<div class="paragraph">
<p>For example, if you want to generate a Java 7 code, you have to ensure that this parameter is <code>complianceLevel="7.0"</code> ou <code>complianceLevel="8.0"</code>.</p>
</div>
</li>
<li>
<p>The level of generated sources is defined according to the global properties <code>maven.compiler.source</code> and <code>maven.compiler.target</code>.
However, if you want to generate code in a different version, you can add the <code>compilerSourceLevel</code> and <code>compilerTargetLevel</code> parameters in the plugin configuration.
An example is shown above.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_properties"><a class="anchor" href="#_properties"></a>Properties</h3>
<div class="paragraph">
<p>These properties are used on this wiki.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;properties&gt;
    ...
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;generated-sources.location&gt;${project.basedir}/src/main/java-gen/&lt;/generated-sources.location&gt;
    &lt;models.location&gt;${project.basedir}/src/main/resources&lt;/models.location&gt;
    ...
&lt;/properties&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependencies"><a class="anchor" href="#_dependencies"></a>Dependencies</h3>
<div class="paragraph">
<p>You need to ensure that all dependencies used in your Xcore file are included in the <em>pom.xml</em>.</p>
</div>
<div class="paragraph">
<p>For a simple Xcore generated file, you just need one dependency which ensures that <code>@Ecore</code> and <code>@GenModel</code> annotations are well known by compiler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.eclipse.emf&lt;/groupId&gt;
    &lt;artifactId&gt;org.eclipse.emf.ecore.xcore.lib&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugins"><a class="anchor" href="#_plugins"></a>Plugins</h3>
<div class="paragraph">
<p>When you create a new project that needs code generation, you need to add some plugins in your <em>pom.xml</em></p>
</div>
<div class="paragraph">
<p>1) Cleaning the previously generated code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;filesets&gt;
            &lt;fileset&gt;
                &lt;directory&gt;${generated-sources.location}&lt;/directory&gt;
            &lt;/fileset&gt;
        &lt;/filesets&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Code generation from Xcore model</p>
</div>
<div class="paragraph">
<p><em>Some plugin dependencies may be added according to your Xcore model</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.eclipse.xtext&lt;/groupId&gt;
    &lt;artifactId&gt;xtext-maven-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;generate-sources&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;generate&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;configuration&gt;
        &lt;encoding&gt;${project.build.sourceEncoding}&lt;/encoding&gt; &lt;!-- Default value --&gt;
        &lt;compilerSourceLevel&gt;${maven.compiler.source}&lt;/compilerSourceLevel&gt; &lt;!-- Default value --&gt;
        &lt;compilerTargetLevel&gt;${maven.compiler.target}&lt;/compilerTargetLevel&gt; &lt;!-- Default value --&gt;
        &lt;languages&gt;
            &lt;language&gt;
                &lt;setup&gt;org.eclipse.xtext.ecore.EcoreSupport&lt;/setup&gt;
            &lt;/language&gt;
            &lt;language&gt;
                &lt;setup&gt;org.eclipse.emf.codegen.ecore.xtext.GenModelSupport&lt;/setup&gt;
            &lt;/language&gt;
            &lt;language&gt;
                &lt;setup&gt;org.eclipse.emf.ecore.xcore.XcoreStandaloneSetup&lt;/setup&gt;
                &lt;outputConfigurations&gt;
                    &lt;outputConfiguration&gt;
                        &lt;outputDirectory&gt;${generated-sources.location}&lt;/outputDirectory&gt;
                    &lt;/outputConfiguration&gt;
                &lt;/outputConfigurations&gt;
            &lt;/language&gt;
        &lt;/languages&gt;
        &lt;sourceRoots&gt;
            &lt;root&gt;${models.location}&lt;/root&gt;
        &lt;/sourceRoots&gt;
    &lt;/configuration&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.eclipse.text&lt;/groupId&gt;
            &lt;artifactId&gt;org.eclipse.text&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.eclipse.emf&lt;/groupId&gt;
            &lt;artifactId&gt;org.eclipse.emf.codegen.ecore.xtext&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.eclipse.emf&lt;/groupId&gt;
            &lt;artifactId&gt;org.eclipse.emf.ecore.xcore&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.eclipse.emf&lt;/groupId&gt;
            &lt;artifactId&gt;org.eclipse.emf.ecore.xcore.lib&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Adding the generated code to the build path</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;add-source&lt;/id&gt;
            &lt;phase&gt;generate-sources&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;add-source&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;sources&gt;
                    &lt;source&gt;${generated-sources.location}&lt;/source&gt;
                &lt;/sources&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Building the generated code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_known_issues"><a class="anchor" href="#_known_issues"></a>Known Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>[Eclipse] - The code generation cannot be executed with the automatic build</strong> (Issue #26)</p>
</div>
<div class="paragraph">
<p>In Eclipse, Maven is integrated with the m2e plugin, which required additional connectors to recognize Maven plugins in a <em>pom.xml</em> file.</p>
</div>
<div class="paragraph">
<p>Unfortunately, there is no connector for the <code>xtext-maven-plugin</code> and it must be added to the "ignore-list" of m2e, according to the <a href="https://www.eclipse.org/m2e/documentation/m2e-execution-not-covered.html#ignore-plugin-goal">m2e official website</a> (There is a quick-fix in Eclipse).</p>
</div>
<div class="paragraph">
<p>In this case, goals that depend on this plugin aren&#8217;t executed automatically.
<strong>You need to invoke the build manually to generate the code, everytime you edit the targetted Xcore model</strong>.
Only code generation is concerned : when code is generated, you should have no problem with it.</p>
</div>
<div class="paragraph">
<p>Use the following command : <code>mvn clean compile</code>.</p>
</div>
<div class="paragraph">
<p><strong>[ERROR] ERROR: A generic type in this context must refer to a classifier or a type parameter</strong>
You can get this error if your <code>pom.xml</code> file doesn&#8217;t contain the following dependencies: <code>org.eclipse.emf.common</code> and <code>org.eclipse.emf.ecore</code>.
Note that the error is reported for every primitive type.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
